<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Your Photos</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Cormorant+Garamond:wght@400;700&display=swap');

        /* Updated Earthy Wedding Palette */
        :root {
            --color-bg-light: #fdf5e6;
            --color-text-dark: #3a2a22;
            --color-accent-green: #90a955;
            --color-accent-rust: #c8815a;
            --color-shadow: rgba(0, 0, 0, 0.15);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text-dark);
            text-align: center;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            position: relative;
            z-index: 2;
            width: 95%;
            max-width: 1200px;
            padding: 3rem 4rem;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 40px var(--color-shadow);
            backdrop-filter: blur(15px);
            animation: float-in 1s ease-out forwards;
            overflow-y: auto;
            max-height: 90vh;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 10% 20%, var(--color-accent-green) 0%, transparent 60%),
                radial-gradient(circle at 90% 80%, var(--color-accent-rust) 0%, transparent 60%);
            background-size: 50% 50%;
            animation: flow-background 30s infinite alternate ease-in-out;
            opacity: 0.25;
            z-index: 1;
        }

        @keyframes float-in {
            0% {
                transform: translateY(50px);
                opacity: 0;
            }

            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes flow-background {
            0% {
                background-position: 0% 0%, 100% 100%;
            }

            100% {
                background-position: 100% 100%, 0% 0%;
            }
        }

        .main-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 3.8rem;
            margin-bottom: 2rem;
            color: var(--color-accent-rust);
        }

        .user-info {
            font-size: 1.5rem;
            margin-bottom: 2rem;
            color: var(--color-text-dark);
        }

        .match-summary {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: var(--color-accent-green);
            font-weight: 600;
        }

        #photo-gallery {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding-bottom: 2rem;
        }

        .photo-card {
            border: 1px solid var(--color-accent-green);
            background-color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 5px 15px var(--color-shadow);
            transition: all 0.3s ease;
            transform: scale(0.9);
            opacity: 0;
            animation: card-fade-in 0.8s ease-out forwards;
            max-width: 300px;
        }

        .photo-card:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px var(--color-shadow);
        }

        .photo-card img {
            max-width: 100%;
            height: auto;
            display: block;
            margin-bottom: 15px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        .photo-info {
            margin-bottom: 15px;
            text-align: left;
        }

        .photo-name {
            font-weight: 600;
            color: var(--color-text-dark);
            margin-bottom: 5px;
            font-size: 0.9rem;
        }

        .similarity-score {
            color: var(--color-accent-green);
            font-size: 0.8rem;
            margin-bottom: 3px;
        }

        .download-btn {
            display: inline-block;
            background-color: var(--color-accent-green);
            color: var(--color-bg-light);
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.3s ease;
            font-size: 0.9rem;
        }

        .download-btn:hover {
            background-color: var(--color-accent-rust);
            transform: translateY(-2px);
        }

        .no-photos {
            font-size: 1.5rem;
            font-style: italic;
            color: var(--color-text-dark);
            margin-top: 2rem;
        }

        .back-btn {
            display: inline-block;
            background-color: var(--color-accent-rust);
            color: var(--color-bg-light);
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 50px;
            font-weight: 600;
            margin-top: 2rem;
            transition: background-color 0.3s ease, transform 0.3s ease;
        }

        .back-btn:hover {
            background-color: var(--color-accent-green);
            transform: translateY(-2px);
        }

        @keyframes card-fade-in {
            0% {
                transform: scale(0.9);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="main-title">Your Photos</h1>

        <div class="user-info">
            Welcome, <strong>{{ user }}</strong>!
        </div>

        {% if total_matches > 0 %}
        <div class="match-summary">
            üéâ Found {{ total_matches }} photo{{ 's' if total_matches > 1 else '' }} with your face!
        </div>

        <div id="photo-gallery">
            {% for photo in matching_files %}
            <div class="photo-card">
                <div class="photo-info">
                    <div class="photo-name">{{ photo.file_name }}</div>
                    <!--  <div class="similarity-score">
                        Match: {{ (photo.similarity_score * 100) | round(1) }}%
                    </div> -->
                <!--   <div class="similarity-score">
                        Faces in image: {{ photo.faces_in_image }}
                    </div> -->
                </div>

                <!-- Real image from Google Drive -->
                <img src="/image/{{ photo.file_id }}" alt="{{ photo.file_name }}"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" loading="lazy">

                <!-- Fallback if image fails to load -->
                <div
                    style="display: none; width: 250px; height: 200px; background: linear-gradient(45deg, #90a955, #c8815a); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-bottom: 15px;">
                    üì∏ Loading...
                </div>

                <a href="/download/{{ photo.file_id }}" class="download-btn" download>
                    Download
                </a>
            </div>
            {% endfor %}
        </div>

        <!-- <a href="/" class="back-btn">Take Another Selfie</a> -->
        {% else %}
        <div class="no-photos">
            <p>No photos were found matching your face.</p>
            <p>Try taking a different selfie or check if your photos are in the system.</p>
        </div>
        <a href="/" class="back-btn">Try Again</a>
        {% endif %}
    </div>

    <script>
        // Add staggered animation using JavaScript instead of Jinja2 loop
        document.addEventListener('DOMContentLoaded', function () {
            const photoCards = document.querySelectorAll('.photo-card');

            photoCards.forEach((card, index) => {
                card.style.animationDelay = (index * 0.1) + 's';
            });

            // Add loading states and error handling
            const images = document.querySelectorAll('.photo-card img');

            images.forEach(img => {
                img.addEventListener('load', function () {
                    this.style.display = 'block';
                    if (this.nextElementSibling) {
                        this.nextElementSibling.style.display = 'none';
                    }
                });

                img.addEventListener('error', function () {
                    this.style.display = 'none';
                    if (this.nextElementSibling) {
                        this.nextElementSibling.style.display = 'block';
                        this.nextElementSibling.textContent = '‚ùå Image not available';
                    }
                });
            });
        });
    </script>
</body>

</html>